<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Carrito de Compras</title>
    <style>
        :root{--accent:#0d6efd;--muted:#6c757d}
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;padding:20px;background:#f7f8fb;color:#111}
        .container{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
        h1{margin:0 0 18px;font-size:20px}
        .empty{padding:40px;text-align:center;color:var(--muted)}
        table{width:100%;border-collapse:collapse;margin-bottom:18px}
        th,td{padding:10px;border-bottom:1px solid #eef1f6;text-align:left;vertical-align:middle}
        th{font-weight:600;color:#374151}
        img.thumb{width:64px;height:64px;object-fit:cover;border-radius:6px;border:1px solid #e6e9ef}
        .qty{width:64px;padding:6px;border-radius:6px;border:1px solid #dfe6f0}
        .actions{display:flex;gap:8px;align-items:center}
        .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
        .btn.secondary{background:#e9eefc;color:var(--accent);border:1px solid #cfe0ff}
        .btn.ghost{background:transparent;color:var(--accent);border:1px solid #e6eefc}
        .remove{background:#ff5959}
        .summary{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:8px}
        .total{font-size:18px;font-weight:700}
        .muted{color:var(--muted);font-size:14px}
        @media (max-width:720px){
            table thead{display:none}
            table,table tbody,table tr,table td{display:block;width:100%}
            table tr{margin-bottom:12px;border-bottom:none}
            td{padding:8px 0;border-bottom:1px solid #f1f4f8}
            td::before{content:"";display:block;font-weight:600;margin-bottom:6px}
            td[data-label]::before{content:attr(data-label)}
            .summary{flex-direction:column;align-items:flex-start}
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Carrito de compras</h1>

        <nav style="margin-bottom:20px;">
            <a href="#" onclick="window.history.back(); return false;" style="display:inline-flex; align-items:center; gap:8px; color:var(--accent); text-decoration:none; font-size:14px;">
            <span>← Volver</span>
            </a>
        </nav>

        <div id="cartRoot">
            <!-- contenido dinámico -->
        </div>
    </div>

    <script>
    // 1. Traer carrito (IDs) desde localStorage
    function obtenerCarrito() {
        return JSON.parse(localStorage.getItem("carrito")) || [];
    }

    // 2. Guardar carrito
    function guardarCarrito(c) {
        localStorage.setItem("carrito", JSON.stringify(c));
    }

    // 3. Formatear moneda ARS
    function formatCurrency(n) {
        return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(n);
    }

    // 4. Obtener productos desde la API según IDs guardados
    async function cargarProductosDelCarrito() {
        const ids = obtenerCarrito();
        if (!ids.length) return [];

        const productos = [];

        for (const id of ids) {
            const res = await fetch(`https://fakestoreapi.com/products/${id}`);
            const data = await res.json();

            // Estructura uniforme
            productos.push({
                id: data.id,
                title: data.title,
                price: data.price,
                img: data.image,
                quantity: 1    // Default
            });
        }

        return productos;
    }

    // 5. Render del carrito
    async function renderCart() {
        const root = document.getElementById("cartRoot");
        root.innerHTML = "";

        const productos = await cargarProductosDelCarrito();

        if (!productos.length) {
            root.innerHTML = `
                <div class="empty">
                    <p>No hay productos en el carrito.</p>
                    <p class="muted">Agrega productos para verlos aquí.</p>
                </div>
            `;
            return;
        }

        // TABLA
        let html = `
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
        `;

        let total = 0;

        productos.forEach((p, index) => {
            const subtotal = p.price * p.quantity;
            total += subtotal;

            html += `
                <tr>
                    <td data-label="Producto">
                        <div style="display:flex; gap:12px; align-items:center">
                            <img class="thumb" src="${p.img}" />
                            <div><strong>${p.title}</strong></div>
                        </div>
                    </td>

                    <td data-label="Precio">${formatCurrency(p.price)}</td>

                    <td>
                        <button class="btn ghost remove" data-index="${index}">Eliminar</button>
                    </td>
                </tr>
            `;
        });

        html += "</tbody></table>";

        // RESUMEN
        html += `
            <div class="summary">
                <div>
                    <div class="muted">Total de productos: <strong>${productos.length}</strong></div>
                    <div class="total">Total: ${formatCurrency(total)}</div>
                </div>

                <div style="display:flex; gap:8px">
                    <button id="backBtn" class="btn secondary">Volver</button>
                    <button id="clearBtn" class="btn secondary">Vaciar carrito</button>
                    <button id="checkoutBtn" class="btn">Finalizar compra</button>
                </div>
            </div>
        `;

        root.innerHTML = html;

        // EVENTOS
        document.querySelectorAll(".qty").forEach(input => {
            input.addEventListener("input", e => {
                let idx = e.target.dataset.index;
                let val = parseInt(e.target.value);

                if (isNaN(val) || val < 1) val = 1;

                productos[idx].quantity = val;
                renderCart(); // Re-render con subtotales actualizados
            });
        });

        document.querySelectorAll(".remove").forEach(btn => {
            btn.addEventListener("click", e => {
                let idx = e.target.dataset.index;
                let ids = obtenerCarrito();
                ids.splice(idx, 1);
                guardarCarrito(ids);
                renderCart();
            });
        });

        document.getElementById("clearBtn").addEventListener("click", () => {
            if (confirm("¿Vaciar carrito?")) {
                localStorage.removeItem("carrito");
                renderCart();
            }
        });

        document.getElementById("checkoutBtn").addEventListener("click", () => {
            alert("Compra finalizada con éxito. Total: " + formatCurrency(total));
            localStorage.removeItem("carrito");
            renderCart();
            window.history.back();
        });

        document.getElementById("backBtn").addEventListener("click", () => {
            window.history.back();
        });
    }

    document.addEventListener("DOMContentLoaded", renderCart);
</script>

</body>
</html>